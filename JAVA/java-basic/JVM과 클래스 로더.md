# JVM?

JVM(Java Virtual Machine)은 자바 언어로 작성된 프로그램을 실행하기 위한 가상 머신입니다. 자바가 OS에서 독립적인 이유는 JVM 때문입니다.

JVM은 바이트 코드(Bytecode)를 해석하고 실행하는 역할을 합니다. 자바 소스 코드(`.java`)는 바이트 코드 형태(`.class`)로 컴파일되며, 이 바이트 코드는 JVM에서 해석되고, 기계어로 변환되어 실행됩니다. JVM은 또한 메모리 관리, 가비지 컬렉션(Garbage Collection), 스레드 관리 등의 작업을 수행합니다.

JVM은 바이트코드를 명령어 단위로 읽어서 해석하는데, Interpreter 방식과 JIT컴파일 두 가지 방식을 혼합하여 사용합니다.

Interpreter 방식은 바이트코드를 한 줄씩 해석하고 실행하는 방식입니다. 컴파일은 소스코드를 한꺼번에 컴퓨터가 읽을 수 있는 기계어로 변환하는 방식입니다.

---

## 자바 코드 실행 과정

JVM 안을 들여다 보기에 앞서 자바 코드가 JVM에게 어떻게 전달되는지 알아야 합니다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/47c075b4-1961-4028-9c9c-b05007eafbcf/Untitled.png)

우리가 작성한 `자바 코드(.java)`는 `자바 컴파일러(javac)`에 의해 `자바 바이트 코드(.class)`로 변경됩니다.

이후 컴파일된 자바 바이트 코드를 JVM의 `클래스 로더`에게 전달합니다.

클래스 로더는 `동적 로딩`을 통해 필요한 클래스들을 `로딩` 및 `링크`하여 런타임 데이터 영역 즉, JVM의 메모리에 로드합니다.

실행엔진은 JVM메모리에 올라온 바이트 코드들을 명령어 단위로 하나씩 가져와서 실행합니다.

---

## 클래스 로더(Class Loader)

클래스 로더는 계층 구조를 가집니다.

부트스트랩(Bootstrap) → 익스텐션(Extention) → 시스템(System) → 사용자정의(User-Defined) 클래스 로더 순입니다.

**부트스트랩 클래스 로더**

- 최상위 클래스 로더로, 유일하게 JAVA가 아닌 네이티브 코드로 구현이 되어 있습니다.
- JVM이 실행될 때 함께 메모리에 로드됩니다.
- Object 클래스를 비롯하여 JAVA API들을 Runtime Data Area에 로드합니다.

익스텐션 클래스 로더

- 기본 JAVA API를 제외한 확장 클래스들을 로드합니다.

시스템 클래스 로더

- 부트스트랩과 익스텐션 클래스로더가 JVM 자체의 구성요소들을 로드한다면, 시스템 클래스 로더는 어플리케이션의 클래스들을 로드합니다.
- 사용자가 지정한 $CLASSPATH 내의 클래스들을 로드합니다.

### 위임모델?

실행엔진에서 명령어 단위로 바이트코드를 실행하다가 처음 참조하는 클래스를 발견했을 때 클래스 로더에게 클래스 로드를 요청합니다. 클래스 로더가 이러한 요청을 받아 클래스를 로드할 때 아래의 순서대로 요청 받은 클래스가 있는지 확인합니다.

1. 클래스 로더 캐시
2. 상위 클래스 로더
3. 자기 자신

클래스 로더 캐시 → 상위 클래스 로더 → 자기 자신 순으로 거슬러 올라가며 확인하는데 올라가는 도중에 요청 받은 클래스를 발견하더라도 최상위 클래스 로더인 부트스트랩 클래스 로더까지 확인합니다.

부트스트랩 클래스 로더에도 요청 받은 클래스가 존재하는 경우 부트스트랩 클래스 로더의 클래스를 로드하게 됩니다.

부트스트랩 클래스 로더에도 클래스가 존재하지 않는다면 클래스 로드를 요청받은 클래스 로더가 파일 시스템에서 해당 클래스를 찾는 것으로 마무리 됩니다.

### 가시성 제한

여기서 자신보다 상위 클래스 로더에 있는 클래스는 확인할 수 있지만 하위 클래스 로더에 있는 클래스는 확인이 불가능 합니다. 이러한 특성이 가시성 제한입니다.

### 언로드 불가

클래스를 로드할 순 있지만 언로드하는 것은 불가능합니다.

### Name Space

네임스페이스란 각 클래스 로더들이 가지고 있는 공간입니다.

이 공간에 로드된 클래스를 보관합니다. 위임 모델을 통해 상위 클래스 로더를 확인하는데 이때 확인하는 공간이 네임스페이스입니다.

### Reference

[[JAVA] JVM 동작원리 및 기본개념](https://steady-snail.tistory.com/67)

[[JAVA] ☕ JVM 내부 구조 & 메모리 영역 자세히 정리](https://inpa.tistory.com/entry/JAVA-☕-JVM-내부-구조-메모리-영역-심화편)